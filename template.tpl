___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "SHA256_leoschuler",
  "version": 1,
  "securityGroups": [],
  "displayName": "Encrypt (Hash) Sensitive Data",
  "categories": [
    "REMARKETING",
    "ADVERTISING",
    "ANALYTICS"
  ],
  "brand": {
    "id": "brand_Suagencia",
    "displayName": "Suagencia",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Encrypt (SHA256) Sensitive data and stored it in a cookie or DataLayer variable. This data can be used to enrich tracking tools such GA4 or Meta",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "stringToHash",
    "displayName": "String to hash",
    "simpleValueType": true,
    "help": "Pass in a Variable which returns the right string. The string passed into this field might be an unique identifier like a User ID or a name.",
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "vkeyName",
    "displayName": "Key Name",
    "simpleValueType": true,
    "help": "Name of the cookie or dataLayer variable",
    "alwaysInSummary": true
  },
  {
    "type": "GROUP",
    "name": "cookieSettings",
    "displayName": "Cookie Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "domain",
        "displayName": "Domain",
        "simpleValueType": true,
        "help": "Set to \u003cstrong\u003eauto\u003c/strong\u003e to write the cookie on the broadest domain name possible.",
        "defaultValue": "auto"
      },
      {
        "type": "TEXT",
        "name": "expirationTime",
        "displayName": "Expiration Time",
        "simpleValueType": true,
        "help": "Cookie Expiration Time in Days",
        "defaultValue": 365,
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "storageLocation",
        "paramValue": "cookie",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "RADIO",
    "name": "storageLocation",
    "displayName": "Storage Location",
    "radioItems": [
      {
        "value": "cookie",
        "displayValue": "Store in Cookie"
      },
      {
        "value": "dataLayer",
        "displayValue": "Store in DataLayer"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "cookie",
    "help": "Use either cookies or Data Layer as destination for the hash; default is cookies"
  },
  {
    "type": "SELECT",
    "name": "outputEncoding",
    "displayName": "Output Encoding",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "base64",
        "displayValue": "base64"
      },
      {
        "value": "hex",
        "displayValue": "hex"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "base64"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Load requirements
const log = require('logToConsole');
const setCookie = require('setCookie');
const sha256 = require('sha256');
const toBase64 = require('toBase64');
const createQueue = require('createQueue');



let cookieMaxAge = 0;
let convertedData = "";
log(data.vkeyName);
log(data);


if (data.stringToHash) {
  log(data.stringToHash);
  
  sha256( data.stringToHash, 
    (digest) => {
      log(digest);
      convertedData = digest;
      log(convertedData);
    
      switch (data.storageLocation) {
        
        case "cookie":
          cookieMaxAge = data.expirationTime * 60 * 60 * 24;    
          setCookie(
            data.vkeyName, 
            convertedData, 
            {
                  "domain": data.domain,
                  "max-age": cookieMaxAge,
                  "path": "/",
                  "samesite": "lax",
                  "secure": true
            }
          );
          break;
        
        
        
        case "dataLayer":        
          const dlObject = {};
          dlObject[data.vkeyName] = convertedData;
          const dataLayerPush = createQueue('dataLayer');
          dataLayerPush(dlObject);
          break;
      }
    
      log("chegou ate aqui");    
      data.gtmOnSuccess();
   },         
      (e) => { 
  log(e);
  data.gtmOnFailure();
},
     {"outputEncoding":data.outputEncoding}
   );
  
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: test1
  code: |2

    // Call runCode to run the template's code.
    runCode(MockData);

    // Verify that the tag finished successfully.
    assertApi('sha256').wasCalled();
setup: |-
  const MockData = {
    stringToHash:"sensitiveData",
    vkeyName:"sd",
    outputEncoding:"base64"
  };


___NOTES___

Created on 3/4/2025, 1:56:06 PM


